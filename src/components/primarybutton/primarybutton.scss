@use '../../mixins' as m;

$primary-gradient: linear-gradient(90deg, #FF007F -93.73%, #7A00FF 96.55%);
$primary-gradient-hover: linear-gradient(90deg, darken(#FF007F, 5%) -93.73%, darken(#7A00FF, 5%) 96.55%);
$btn-bg-dark: var(--black-color);
$disabled-opacity: 0.6;

.primary-component {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  border: none;
  cursor: pointer;
  padding-inline: 0.25rem;
  background: $primary-gradient;
  border-radius: 50px;
  box-shadow: 
    1.4px 5.61px 7.01px 0px rgba(0, 0, 0, 0.25) inset,
    0 4px 16px rgba(122, 0, 255, 0.2);
  outline: none;
  -webkit-tap-highlight-color: transparent;
  position: relative;
  overflow: hidden;
  isolation: isolate;

  min-height: clamp(40px, 3.6vw, 56px);
  height: auto;
  min-width: clamp(140px, 12vw, 272px);
  padding: clamp(6px, 0.6vw, 12px) clamp(8px, 1.2vw, 20px);

  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  will-change: transform;

  // Background overlay for hover effects
  .button-background {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.6s ease;
    z-index: -1;
  }

  .primary-text {
    display: inline-block;
    color: var(--white-color);
    text-align: center;
    white-space: nowrap;
    position: relative;
    z-index: 1;

    @include m.font-size(16);
    @include m.line-height(18);
    font-weight: 600;

    font-size: clamp(14px, 1.6vw, 22px);
    line-height: 1;
    padding-inline: clamp(8px, 1.2vw, 16px);
    transition: transform 0.2s ease;

    .loading-text {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .loading-dots {
      display: flex;
      gap: 0.2rem;

      span {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: currentColor;
        animation: loading-bounce 1.4s ease-in-out infinite both;

        &:nth-child(1) { animation-delay: -0.32s; }
        &:nth-child(2) { animation-delay: -0.16s; }
        &:nth-child(3) { animation-delay: 0s; }
      }
    }
  }

  .action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: $btn-bg-dark;
    box-shadow: 
      1.4px 5.61px 7.01px 0px rgba(0, 0, 0, 0.25) inset,
      0 2px 8px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 1;

    width: clamp(36px, 3.2vw, 48px);
    height: clamp(36px, 3.2vw, 48px);
    padding: 0;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    .action-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    img {
      width: 60%;
      height: 60%;
      object-fit: contain;
      object-position: center;
      filter: brightness(0) saturate(100%) invert(86%) sepia(0%) saturate(0%) hue-rotate(224deg) brightness(96%) contrast(90%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: block;

      &.hovered {
        filter: brightness(0) saturate(100%) invert(100%);
        transform: translateX(1px);
      }
    }

    .spinner {
      width: 60%;
      height: 60%;
      border: 2px solid transparent;
      border-top: 2px solid var(--white-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
  }

  &:hover:not(.disabled):not(.loading) {
    transform: translateY(-2px);

    .button-background {
      left: 100%;
    }

    .primary-text {
      transform: translateX(-1px);
    }
  }

  // Pressed state
  &.pressed:not(.disabled):not(.loading) {
    transform: translateY(0) scale(0.98);
    box-shadow: 
      1.4px 5.61px 7.01px 0px rgba(0, 0, 0, 0.35) inset,
      0 2px 8px rgba(122, 0, 255, 0.2);

    .primary-text {
      transform: translateX(0) scale(0.98);
    }

    .action-btn {
      transform: scale(0.95);
      box-shadow: 
        1.4px 5.61px 7.01px 0px rgba(0, 0, 0, 0.4) inset,
        0 1px 4px rgba(0, 0, 0, 0.3);
    }
  }

  &:focus:not(.disabled):not(.loading) {
    box-shadow: 
      0 0 0 4px rgba(122, 0, 255, 0.12),
      0 8px 24px rgba(0, 0, 0, 0.35),
      1.4px 5.61px 7.01px 0px rgba(0, 0, 0, 0.25) inset;
    outline: none;
  }

  &.disabled {
    cursor: not-allowed;
    opacity: $disabled-opacity;
    transform: none !important;

    .button-background {
      display: none;
    }

    .primary-text,
    .action-btn {
      transform: none !important;
    }
  }

  // Loading state
  &.loading {
    cursor: wait;
    
    .primary-text,
    .action-btn {
      transform: none !important;
    }
  }

  // Active state for form submission feedback
  &.submitting {
    position: relative;
    overflow: hidden;

    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    }
  }

  // Responsive styles
  @include m.media(mobile) {
    min-width: 120px;
    .primary-text {
      font-size: clamp(13px, 3.2vw, 16px);
      padding-inline: 8px;
    }
  }

  @include m.media(tablet) {
    min-width: clamp(150px, 20vw, 220px);
    .primary-text {
      font-size: clamp(14px, 2.2vw, 18px);
    }
  }

  @include m.media(laptop) {
    min-width: clamp(170px, 14vw, 260px);
    .primary-text {
      font-size: clamp(16px, 1.8vw, 20px);
    }
  }

  @include m.media(desktop) {
    min-width: clamp(180px, 11vw, 300px);
    .primary-text {
      font-size: clamp(18px, 1.6vw, 22px);
    }
    .action-btn {
      width: clamp(40px, 2.2vw, 52px);
      height: clamp(40px, 2.2vw, 52px);
    }
  }

  @include m.media(qhd) {
    min-width: clamp(200px, 9.5vw, 340px);
    .primary-text {
      font-size: clamp(20px, 1.4vw, 28px);
    }
    .action-btn {
      width: clamp(44px, 1.6vw, 60px);
      height: clamp(44px, 1.6vw, 60px);
      img {
        width: 64%;
      }
    }
  }

  @include m.media(uhd) {
    min-width: clamp(230px, 7.5vw, 380px);
    .primary-text {
      font-size: clamp(24px, 1.2vw, 34px);
    }
    .action-btn {
      width: clamp(48px, 1.2vw, 72px);
      height: clamp(48px, 1.2vw, 72px);
      img {
        width: 70%;
      }
    }
  }
}

// Animations
@keyframes loading-bounce {
  0%, 80%, 100% {
    transform: scale(0.8);
    opacity: 0.5;
  }
  40% {
    transform: scale(1.2);
    opacity: 1;
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: reduce) {
  .primary-component {
    transition: none !important;

    .primary-text,
    .action-btn,
    .button-background {
      transition: none !important;
    }

    .loading-dots span {
      animation: none !important;
      opacity: 1;
    }

    .spinner {
      animation: none !important;
    }

    &.submitting::after {
      animation: none !important;
    }
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  .primary-component {
    border: 2px solid currentColor;
    
    .action-btn {
      border: 1px solid currentColor;
    }
  }
}